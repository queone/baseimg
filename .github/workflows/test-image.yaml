name: test-image

on:
  workflow_dispatch:
    inputs:
      tag_name:
        description: 'Run image test'     
        required: true              
        type: string

permissions:
  contents: write # Allow workflow to create releases

jobs:
  test-image:    
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/queone/ubi9:1.0.0
      credentials:
        username: ${{ github.actor }}
        password: ${{ secrets.GHCR_PAT }}
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.inputs.tag_name }}

      - name: Setup Go environment
        uses: actions/setup-go@v5
        with:
          go-version: '1.23.4'

      - name: Test commands
        run: |
          Gre='\e[1;32m' Red='\e[1;31m' Pur='\e[1;35m' Yel='\e[1;33m' Blu='\e[1;34m' Rst='\e[0m'
          printf "${Gre}START${Rst}\n"
          git --version
          ls -l
          cat /etc/os-release
          uname -m
          go version
          printf "${Red}END!${Rst}\n"

      # - name: create_release
      #   id: create_release
      #   uses: actions/create-release@v1
      #   env:
      #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      #     # Above is provided by Actions, you do not need to create your own token
      #   with:
      #     tag_name: ${{ github.event.inputs.tag_name }}
      #     release_name: Release ${{ github.event.inputs.tag_name }}
      #     draft: false
      #     prerelease: false
      #     body: 'Release ${{ github.event.inputs.tag_name }}'
      # - name: upload_release_assets
      #   uses: actions/upload-release-asset@v1
      #   env:
      #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      #   with:
      #     upload_url: ${{ steps.create_release.outputs.upload_url }}
      #     # Above is the upload URL for the release
      #     asset_path: ${{ env.BinaryName }}.tgz
      #     asset_name: ${{ env.BinaryName }}.tgz
      #     asset_content_type: application/gzip

